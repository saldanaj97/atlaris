#!/bin/sh

# Run Prettier on staged files
echo "Running Prettier on staged files..."
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)
if [ -n "$STAGED_FILES" ]; then
  echo "$STAGED_FILES" | xargs pnpm exec prettier --write --ignore-unknown || true
  echo "$STAGED_FILES" | xargs git add
fi

# Skip ggshield when not installed
echo "Running ggshield secret scan..."
if ! command -v ggshield >/dev/null 2>&1; then
  echo "⚠️  ggshield not installed, skipping secret scan"
else
  # ggshield will use GITGUARDIAN_API_KEY if set, otherwise it uses local auth
  ggshield secret scan pre-commit
  if [ $? -ne 0 ]; then
    echo "❌ Secret scan failed, aborting commit"
    exit 1
  else
    echo "✅ Secret scan passed"
  fi
fi